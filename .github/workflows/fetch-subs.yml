name: "fetch-subs"
on:
  workflow_dispatch:
  schedule:
    # 2000 new subs every day
    # 83.3 new subs every hour
    # 30 new subs every 21.6 minutes # rate limit: 30 requests
    # 20.8 new subs every 15 minutes
    # 13.9 new subs every 10 minutes
    # run every 10 minutes:
    - cron:  '*/10 * * * *'
    # run every 20 minutes:
    #- cron:  '*/20 * * * *'
  push:
    branches:
      - main
      - test
jobs:
  fetch_subs:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: '0'
    - uses: actions/setup-python@v4
      with:
        # latest stable version of python 3
        python-version: '3.x'
        #python-version-file: '.python-version'
        # cache pip dependencies
        cache: 'pip'
    - run: pip install -r requirements.txt
    - name: debug-before
      run: bash -c "set -x; ls -l"
    - name: fetch-subs.py
      run: ./fetch-subs.py --num-downloads 3 --first-num 9539186
      # https://github.com/your_name/your_repo/settings/secrets/actions
      #env:
      #  API_TOKEN_GITHUB: '${{ secrets.API_TOKEN_GITHUB }}'
      #  API_USER_GITHUB: '${{ secrets.API_USER_GITHUB }}'
    - name: debug-after
      run: bash -c "set -x; ls -l; ls -l new-subs/"
    #- name: store-subs.py
    #  run: ./store-subs.py
